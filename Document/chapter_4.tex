%   Filename    : chapter_4.tex 
\chapter{System Prototype}
\label{sec:prototype}

\section{System Design and Architecture}

\begin{doublespace}

This study will employ components to gather accurate measurements of reaction time. The device will be composed of one master controller and multiple stations. The study will use the ESP-NOW protocol to achieve wireless connection between the main controller and the stations. ESP-NOW is a wireless communication protocol defined by Espressif which enables multiple ESP based microcontrollers to communicate wirelessly. It is a quick and low-power way to handle connection that is based on the data link layer to achieve faster transmission. The system will be controlled by a web application initially, as well as storing the data gathered by the system. In later development stages, the system will shift to using a mobile application instead.

\end{doublespace}

\subsection{IOT Components}

\begin{doublespace}

\begin{figure}[ht]              
	\centering                    
	\includegraphics{Master_node.png}      
	\caption{Schematic Circuit Diagram of the Master Controller }
	\label{fig:Master_node}
\end{figure}

\figref{fig:Master_node} illustrates the schematic circuit diagram of the main (master) controller. At the core of the design is a standard ESP32 microcontroller, which manages two primary tasks: sending commands to the station modules and collecting the reaction-time data they generate. The gathered data will be transmitted using a Python application, displayed through a web application, and then uploaded to a Firebase database for online storage. The main controller also includes a DF Mini MP3 player module that provides audio cues for training modes requiring sound-based stimuli. This module reads audio files stored on an SD card and outputs them through a connected 3W speaker for clear and amplified playback. The entire system is powered by a 3.7V 18650 battery. A TP4056 charging module with built-in protection ensures safe charging and prevents overcharging. A 3.3V voltage regulator provides a stable supply for the ESP32, while a separate step-up converter generates the required 5V output for the DF Mini MP3 module and the speaker.

\end{doublespace}

\begin{figure}[h]               
	\centering                    
	\includegraphics{Station_node.png}      
	\caption{Schematic Circuit Diagram of the Station Controller }
	\label{fig:Station_node}
\end{figure}

\begin{doublespace}

For the station nodes, \figref{fig:Station_node} presents their circuit schematic diagram. Each station uses an ESP32 Super Mini C3 microcontroller, chosen for its compact size and sufficient number of GPIO pins to support the required sensors. The station node receives commands from the main controller and executes them accordingly. It controls a programmable LED strip, which lights up based on the received command and turns off when the connected infrared sensor detects a response. The station then records the performer’s reaction time and sends this data back to the main controller. Like the main controller, each station node is powered by a 3.7V 18650 battery paired with a TP4056 charging module with built-in protection. A voltage regulator provides a stable 3.3V supply for the microcontroller, while a step-up converter generates the 5V needed for the LED strip. The LED strip is connected through a dual MOSFET driver, which serves as a switch to safely control the 5V load from the station controller.

\end{doublespace}

\subsection{Software Application}

\begin{doublespace}

The programming of the IOT components will be implemented in C++ using the Arduino-ESP32 core. The master controller manages ESP-NOW peer-to-peer communication with all stations, broadcasts synchronized commands, aggregates reaction-time data, and forwards it to the application via Wi-Fi. Station controllers execute commands, control WS2812B LEDs, measure reaction times with microsecond precision using hardware timers, and return data via ESP-NOW. ESP-NOW was chosen for its less than 2 ms latency and connectionless design, ensuring the temporal accuracy required for valid reaction-time measurement.

The system will initially utilize a web application built with React, Typescript, and Tailwind CSS. Eventually, a mobile application will be developed using Flutter to serve as the primary control method and data management of the system, offering superior performance, smoother animations, native push notifications, better battery management, and both applications connect to the same online database, ensuring identical functionality and seamless data continuity during the transition period.

The mobile application will interface with the hardware device via Bluetooth, enabling both device control and the collection of training data. The application will provide role-based access through two distinct user dashboards: one for coaches and one for athletes.

The coach dashboard will present aggregated and individual performance metrics obtained from athletes during training sessions, allowing coaches to monitor, evaluate, and manage athlete performance. In contrast, the athlete dashboard will display personalized training statistics, enabling athletes to review and track their own performance data. While both user roles will have the capability to control the device through the mobile application, coaches will have the additional responsibility of assigning or selecting the athlete currently using the device.

The system will support offline operation when gathering data. When an internet connection is unavailable, training data will be stored locally on the mobile device and will be automatically synchronized with Google Firebase Firestore once connectivity is restored.

\end{doublespace}

\section{Training Protocols}

\begin{doublespace}

To assess the effectiveness of the proposed light-based reaction training system, three customizable training drills were developed to target key perceptual-motor skills essential in racket sports, including reaction time, decision-making, movement initiation, and agility. Each drill employs visual and/or auditory stimuli delivered via the system’s LED modules and speakers, while infrared sensors are used to capture response timing and movement execution. Although the drills are designed to be applicable across badminton, tennis, and table tennis, their parameters can be systematically adjusted to accommodate the distinct biomechanical and perceptual demands of each sport.

\end{doublespace}

\subsection{Randomized Single-Target Movement Drill}

\begin{doublespace}

In this drill, the athlete starts from a fixed central position while multiple training stations are placed around the athlete at predefined locations. At the beginning of each trial, a single station activates its LED at random. Upon activation, the athlete immediately moves toward the illuminated station and triggers the infrared sensor using the hand or racket. Once the response is detected, the system deactivates the station and initiates the next trial after a short configurable delay. Station placement and distance are adjusted based on the sport: wider spacing is used for badminton and tennis to require forward, backward, and lateral footwork, while closer spacing is used for table tennis to emphasize short, rapid movements.

\end{doublespace}

\subsection{Multi-Directional Choice Movement Drill}

\begin{doublespace}

This drill requires the athlete to respond to a sequence of visual stimuli that demand movement in different directions. The athlete begins at a central starting point, and one station activates at a time following a randomized sequence. For each activation, the athlete moves to the corresponding station, triggers the infrared sensor, and returns to the starting position before the next stimulus occurs. Movement patterns include lateral shuffles, diagonal steps, and forward–backward transitions. The number of active stations, sequence length, and response time window are configurable to match the movement demands of badminton, tennis, and table tennis.

\end{doublespace}

\subsection{Sequential Multimodal Movement Drill}

\begin{doublespace}

In this drill, movement execution is guided by combined audio and visual cues. An audio signal marks the start of each trial, followed by one or more stations activating in sequence. The athlete responds by moving to each activated station in the order presented and triggering the infrared sensor at each location. After completing the sequence, the system resets and prepares for the next trial. The number of stations in a sequence, activation speed, and movement distance can be adjusted. For badminton and tennis, longer movement paths and rapid direction changes are emphasized, while for table tennis, the drill prioritizes fast alternating movements over shorter distances.

\end{doublespace}