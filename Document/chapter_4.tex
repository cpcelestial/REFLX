%   Filename    : chapter_4.tex 
\chapter{System Prototype}
\label{sec:prototype}

\section{System Design and Architecture}

\begin{doublespace}

This study will employ components to gather accurate measurements of reaction time. The device will be composed of one master controller and multiple stations. The study will use the ESP-NOW protocol to achieve wireless connection between the main controller and the stations. ESP-NOW is a wireless communication protocol defined by Espressif which enables multiple ESP based microcontrollers to communicate wirelessly. It is a quick and low-power way to handle connection that is based on the data link layer to achieve faster transmission. The system will be controlled by a web application initially, as well as storing the data gathered by the system. In later development stages, the system will shift to using a mobile application instead.

\end{doublespace}

\subsection{IOT Components}

\begin{doublespace}

\begin{figure}[ht]              
	\centering                    
	\includegraphics{Master_node.png}      
	\caption{Schematic Circuit Diagram of the Master Controller }
	\label{fig:Master_node}
\end{figure}

\figref{fig:Master_node} illustrates the schematic circuit diagram of the main (master) controller. At the core of the design is a standard ESP32 microcontroller, which manages two primary tasks: sending commands to the station modules and collecting the reaction-time data they generate. The gathered data will be transmitted using a Python application, displayed through a web application, and then uploaded to a Firebase database for online storage. The main controller also includes a DF Mini MP3 player module that provides audio cues for training modes requiring sound-based stimuli. This module reads audio files stored on an SD card and outputs them through a connected 3W speaker for clear and amplified playback. The entire system is powered by a 3.7V 18650 battery. A TP4056 charging module with built-in protection ensures safe charging and prevents overcharging. A 3.3V voltage regulator provides a stable supply for the ESP32, while a separate step-up converter generates the required 5V output for the DF Mini MP3 module and the speaker.

\end{doublespace}

\begin{figure}[h]               
	\centering                    
	\includegraphics{Station_node.png}      
	\caption{Schematic Circuit Diagram of the Station Controller }
	\label{fig:Station_node}
\end{figure}

\begin{doublespace}

For the station nodes, \figref{fig:Station_node} presents their circuit schematic diagram. Each station uses an ESP32 Super Mini C3 microcontroller, chosen for its compact size and sufficient number of GPIO pins to support the required sensors. The station node receives commands from the main controller and executes them accordingly. It controls a programmable LED strip, which lights up based on the received command and turns off when the connected infrared sensor detects a response. The station then records the performerâ€™s reaction time and sends this data back to the main controller. Like the main controller, each station node is powered by a 3.7V 18650 battery paired with a TP4056 charging module with built-in protection. A voltage regulator provides a stable 3.3V supply for the microcontroller, while a step-up converter generates the 5V needed for the LED strip. The LED strip is connected through a dual MOSFET driver, which serves as a switch to safely control the 5V load from the station controller.

\end{doublespace}

\subsection{Software Application}

\begin{doublespace}

The programming of the IOT components will be implemented in C++ using the Arduino-ESP32 core. The master controller manages ESP-NOW peer-to-peer communication with all stations, broadcasts synchronized commands, aggregates reaction-time data, and forwards it to the application via Wi-Fi. Station controllers execute commands, control WS2812B LEDs, measure reaction times with microsecond precision using hardware timers, and return data via ESP-NOW. ESP-NOW was chosen for its less than 2 ms latency and connectionless design, ensuring the temporal accuracy required for valid reaction-time measurement.

The data gathered will be stored locally in during offline operation, and automatically synchronizes to Google Firebase Firestore upon network availability. A robust queueing system ensures zero data loss even during prolonged offline training. The system will initially utilize a web application built with React, Typescript, and Tailwind CSS. Eventually, a mobile application will be developed using Flutter to serve as the primary control method and data management of the system, offering superior performance, smoother animations, native push notifications, better battery management, and both applications connect to the same online database, ensuring identical functionality and seamless data continuity during the transition period.

\end{doublespace}